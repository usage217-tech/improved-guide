<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mythos Engine - Setup</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script> 
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* ... Keep your existing CSS ... */
        /* You can hide the #tab-chat section entirely in CSS if you want */
        @import url('https://fonts.googleapis.com/css2?family=Pacifico&family=Cinzel:wght@400;700&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400;1,600&family=Inter:wght@300;400&display=swap');
        
        /* Copy the rest of your CSS from the original file here */
        :root { --royal-purple: #c084fc; --deep-purple: #581c87; --night-bg: #030005; }
        body { font-family: 'Inter', sans-serif; background: var(--night-bg); color: #e9d5ff; }
        /* ... etc ... */
        .royal-card { background: rgba(15, 5, 20, 0.6); border: 1px solid rgba(192, 132, 252, 0.15); border-radius: 24px; }
        .active { background: linear-gradient(135deg, #a855f7, #4c1d95) !important; color: white !important; }
        .hidden { display: none !important; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <header class="p-6 border-b border-purple-900/30 bg-black/20 backdrop-blur-md flex justify-between items-center z-50">
        <h1 class="font-pacifico text-xl text-purple-300 gold-glow tracking-wide">Mythos Engine</h1>
    </header>

    <div id="tab-nav" class="flex bg-black/30 border-b border-purple-900/20 z-40 backdrop-blur-sm">
        <button onclick="showTab('ai')" id="btn-ai" class="tab-btn active-tab flex-1 py-4 font-cinzel text-[10px] font-bold uppercase tracking-[0.3em]">The Monarch</button>
        <button onclick="showTab('you')" id="btn-you" class="tab-btn flex-1 py-4 font-cinzel text-[10px] font-bold uppercase tracking-[0.3em]">The Guest</button>
        <button onclick="showTab('scene')" id="btn-scene" class="tab-btn flex-1 py-4 font-cinzel text-[10px] font-bold uppercase tracking-[0.3em]">The Kingdom</button>
    </div>

    <main class="flex-1 overflow-y-auto p-4">
        <div id="tab-ai" class="tab-content">
            <div class="space-y-4">
                <div class="flex gap-2">
                    <button onclick="setAiGender('Male')" id="ai-gender-male" class="p-4 border border-purple-500 rounded text-purple-200">King</button>
                    <button onclick="setAiGender('Female')" id="ai-gender-female" class="p-4 border border-purple-500 rounded text-purple-200">Queen</button>
                </div>
                <div id="ai-character-cards" class="grid gap-2 mt-4"></div>
                <div id="ai-custom-fields" class="hidden space-y-2">
                    <input id="ai-custom-name" placeholder="Name" class="w-full p-2 bg-black border border-purple-500 rounded text-white">
                    <textarea id="ai-custom-desc" placeholder="Description" class="w-full p-2 bg-black border border-purple-500 rounded text-white"></textarea>
                </div>
                <button onclick="showTab('you')" class="w-full p-4 bg-purple-900 rounded text-white mt-4">Next: You</button>
            </div>
        </div>

        <div id="tab-you" class="tab-content hidden">
            <div class="space-y-4">
                <input id="user-display-name" placeholder="Your Name" class="w-full p-4 bg-black border border-purple-500 rounded text-white">
                <button onclick="showTab('scene')" class="w-full p-4 bg-purple-900 rounded text-white mt-4">Next: Scene</button>
            </div>
        </div>

        <div id="tab-scene" class="tab-content hidden">
             <div id="scene-suggestions" class="grid gap-2 mb-4"></div>
             <textarea id="scenario-input" placeholder="Scenario..." class="w-full h-32 p-4 bg-black border border-purple-500 rounded text-white"></textarea>
             
             <button onclick="sendDataToTelegram()" class="w-full py-6 mt-6 bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-bold rounded-xl shadow-lg animate-pulse">
                MANIFEST REALITY
             </button>
        </div>
    </main>

    <script>
        // Initialize Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.expand(); // Make it full screen

        // DATA CONSTANTS (Keep your lists here)
        const CHARACTERS = {
            Female: [
                { id: 'custom', name: "Custom Soul", desc: "Forge a unique entity from the void.", isCustom: true },
                { name: "Lilith", desc: "Ancient Female seductive succubus. Hourglass form, crimson skin, small horns. Insatiable lust feeder.", scenes: ["You secretly descended into the forgotten catacombs... a crimson silhouette waited...", "You broke into the sealed crypt at moonrise... curvy dark form stepped out...",] },
                { name: "Hellien", desc: "300-year-old elegant vampire queen. Pale flawless skin, lithe athletic body. Predatory dominant.", scenes: ["You climbed the crumbling tower stairs... elegant lithe body draped in crimson silk...", "You slipped through the secret passage... regal figure rose from darkness..."] },
                { name: "Maya", desc: "38-year-old ruthless billionaire CEO. Tall toned, power suits. Ice-cold control freak.", scenes: ["You used the override code... sharp silhouette turned from the windows...", "You infiltrated the private penthouse elevator... commanding figure stood at the bar..."] },
                { name: "Nika", desc: "21-year-old spoiled rich stepsis. Slim athletic, bratty smirk. Teasing heiress vibe.", scenes: ["The mansion was silent past 2 AM... bedroom door eased open...", "You heard the shower stop... bratty silhouette appeared in the corridor..."] },
                { name: "Mrs. Grace", desc: "39-year-old seductive milf stepmom. Voluptuous curves. Nurturing yet predatory.", scenes: ["You came downstairs for a midnight snack... voluptuous silhouette leaned against the island...", "Master bedroom door cracked open... seductive milf figure sat on the edge of the bed..."] }
            ],
            Male: [
                { id: 'custom', name: "Custom Soul", desc: "Forge a unique entity from the void.", isCustom: true },
                { name: "Robert", desc: "35-year-old brooding tech billionaire. Tall broad, chiseled jaw. Possessive owner.", scenes: ["You were driven to his secluded coastal compound... tall broad silhouette waited...", "You entered the underground bunker... brooding figure stood at the control panel..."] },
                { name: "John", desc: "24-year-old dominant stepbro. Tall muscular, ripped abs, cocky grin. Possessive big-bro energy.", scenes: ["House lights off... parents gone... tall muscular shadow filled the frame...", "Door eased open... dominant stepbro silhouette entered... cocky grin in moonlight."] },
                { name: "Mike", desc: "46-year-old wealthy stepdad. Tall broad, silver-streaked hair. Strict daddy dom.", scenes: ["Mansion was quiet... tall broad silhouette appeared in the doorway...", "Woke to the sound of a key... wealthy stepdad figure stepped into your room..."] }
            ]
        }; 

        let aiConfig = { gender: '', name: '', description: '' };
        let userConfig = { name: '' };
        let scenario = '';

        // UI FUNCTIONS (Simplified for brevity, use your full logic)
        function showTab(id) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById('tab-'+id).classList.remove('hidden');
        }

        function setAiGender(g) {
            aiConfig.gender = g;
            // Render characters logic here (same as your original code)
            const container = document.getElementById('ai-character-cards');
            container.innerHTML = '';
            CHARACTERS[g].forEach(char => {
                const btn = document.createElement('button');
                btn.className = "p-4 border border-purple-500/50 rounded text-left w-full hover:bg-purple-900/20";
                btn.innerText = char.name;
                btn.onclick = () => {
                    if(char.isCustom) {
                        document.getElementById('ai-custom-fields').classList.remove('hidden');
                    } else {
                        aiConfig.name = char.name;
                        aiConfig.description = char.desc;
                        document.getElementById('ai-custom-fields').classList.add('hidden');
                        renderScenes(char);
                    }
                    // Highlight logic...
                };
                container.appendChild(btn);
            });
        }
        
        function renderScenes(char) {
            const sc = document.getElementById('scene-suggestions');
            sc.innerHTML = '';
            if(char.scenes) {
                char.scenes.forEach(s => {
                    const b = document.createElement('button');
                    b.className = "p-2 border border-purple-500/30 rounded text-xs text-left w-full";
                    b.innerText = s.substring(0, 50) + "...";
                    b.onclick = () => {
                        scenario = s;
                        document.getElementById('scenario-input').value = s;
                    };
                    sc.appendChild(b);
                });
            }
        }

        // --- THE KEY FUNCTION ---
        function sendDataToTelegram() {
            // 1. Get final values
            const customName = document.getElementById('ai-custom-name').value;
            const customDesc = document.getElementById('ai-custom-desc').value;
            const userName = document.getElementById('user-display-name').value;
            const finalScenario = document.getElementById('scenario-input').value;

            if (aiConfig.name === 'Custom' || !aiConfig.name) {
                aiConfig.name = customName;
                aiConfig.description = customDesc;
            }
            userConfig.name = userName;
            scenario = finalScenario;

            if(!aiConfig.name || !userConfig.name || !scenario) {
                tg.showAlert("Please complete all fields (AI Name, User Name, Scenario)");
                return;
            }

            // 2. Prepare Payload
            const payload = {
                ai_name: aiConfig.name,
                ai_desc: aiConfig.description,
                user_name: userConfig.name,
                scenario: scenario
            };

            // 3. Send to Bot
            tg.sendData(JSON.stringify(payload));
        }
    </script>
</body>
</html>
